(function(){var local=false;if(document.location.search.length>0){var params=document.location.search.substr(1).split("&");for(var i=0;i<params.length;i++){if(params[i]=="local"){local=true}}}if(!local){var heads=document.documentElement.getElementsByTagName("head");for(var h=0;h<heads.length;h++){var node=heads[h].firstChild;while(node!=null){if(node.nodeType==1&&node.tagName.toLowerCase()=="script"){var url=node.src;if(url.indexOf("timeplot-api")>=0){local=(url.indexOf("local")>=0)}}node=node.nextSibling}}}var loadTimeplot=function(){if(typeof window.Timeplot!="undefined"){return}window.Timeplot={loaded:false,params:{bundle:true,autoCreate:true},namespace:"http://simile.mit.edu/2007/06/timeplot#",importers:{}};var javascriptFiles=["timeplot.js","plot.js","sources.js","geometry.js","color.js","math.js","processor.js"];var cssFiles=["timeplot.css"];var locales=["en"];var defaultClientLocales=("language" in navigator?navigator.language:navigator.browserLanguage).split(";");for(var l=0;l<defaultClientLocales.length;l++){var locale=defaultClientLocales[l];if(locale!="en"){var segments=locale.split("-");if(segments.length>1&&segments[0]!="en"){locales.push(segments[0])}locales.push(locale)}}var paramTypes={bundle:Boolean,js:Array,css:Array,autoCreate:Boolean};if(typeof Timeplot_urlPrefix=="string"){Timeplot.urlPrefix=Timeplot_urlPrefix;if("Timeplot_parameters" in window){SimileAjax.parseURLParameters(Timeplot_parameters,Timeplot.params,paramTypes)}}else{var url=SimileAjax.findScript(document,"/timeplot-api.js");if(url==null){Timeplot.error=new Error("Failed to derive URL prefix for Simile Timeplot API code files");return}Timeplot.urlPrefix=url.substr(0,url.indexOf("timeplot-api.js"));SimileAjax.parseURLParameters(url,Timeplot.params,paramTypes)}if(Timeplot.params.locale){if(Timeplot.params.locale!="en"){var segments=Timeplot.params.locale.split("-");if(segments.length>1&&segments[0]!="en"){locales.push(segments[0])}locales.push(Timeplot.params.locale)}}var timeplotURLPrefix=(local)?"/static/timeplot_js/":Timeplot.urlPrefix;if(local&&!("console" in window)){var firebug=[timeplotURLPrefix+"lib/firebug/firebug.js"];SimileAjax.includeJavascriptFiles(document,"",firebug)}var canvas=document.createElement("canvas");if(!canvas.getContext){var excanvas=[timeplotURLPrefix+"lib/excanvas.js"];SimileAjax.includeJavascriptFiles(document,"",excanvas)}var scriptURLs=Timeplot.params.js||[];var cssURLs=Timeplot.params.css||[];if(Timeplot.params.bundle){scriptURLs.push(timeplotURLPrefix+"timeplot-bundle.js");cssURLs.push(timeplotURLPrefix+"timeplot-bundle.css")}else{SimileAjax.prefixURLs(scriptURLs,timeplotURLPrefix+"scripts/",javascriptFiles);SimileAjax.prefixURLs(cssURLs,timeplotURLPrefix+"styles/",cssFiles)}window.SimileAjax_onLoad=function(){if(local&&window.console.open){window.console.open()}if(Timeplot.params.callback){eval(Timeplot.params.callback+"()")}};SimileAjax.includeJavascriptFiles(document,"",scriptURLs);SimileAjax.includeCssFiles(document,"",cssURLs);Timeplot.loaded=true};var loadTimeline=function(){if(typeof Timeline!="undefined"){loadTimeplot()}else{var timelineURL=(local)?"/timeline/api-2.0/timeline-api.js?bundle=false":"http://static.simile.mit.edu/timeline/api-2.0/timeline-api.js";window.SimileAjax_onLoad=loadTimeplot;SimileAjax.includeJavascriptFile(document,timelineURL)}};if(typeof SimileAjax=="undefined"){window.SimileAjax_onLoad=loadTimeline;var url=local?"/ajax/api-2.0/simile-ajax-api.js?bundle=false":"http://static.simile.mit.edu/ajax/api-2.0/simile-ajax-api.js?bundle=true";var createScriptElement=function(){var script=document.createElement("script");script.type="text/javascript";script.language="JavaScript";script.src=url;document.getElementsByTagName("head")[0].appendChild(script)};if(document.body==null){try{document.write("<script src='"+url+"' type='text/javascript'><\/script>")}catch(e){createScriptElement()}}else{createScriptElement()}}else{loadTimeline()}})();Timeline.Debug=SimileAjax.Debug;var log=SimileAjax.Debug.log;Object.extend=function(a,b){for(var c in b){a[c]=b[c]}return a};Timeplot.create=function(a,b){return new Timeplot._Impl(a,b)};Timeplot.createPlotInfo=function(a){return{id:("id" in a)?a.id:"p"+Math.round(Math.random()*1000000),dataSource:("dataSource" in a)?a.dataSource:null,eventSource:("eventSource" in a)?a.eventSource:null,timeGeometry:("timeGeometry" in a)?a.timeGeometry:new Timeplot.DefaultTimeGeometry(),valueGeometry:("valueGeometry" in a)?a.valueGeometry:new Timeplot.DefaultValueGeometry(),timeZone:("timeZone" in a)?a.timeZone:0,fillColor:("fillColor" in a)?((a.fillColor=="string")?new Timeplot.Color(a.fillColor):a.fillColor):null,fillGradient:("fillGradient" in a)?a.fillGradient:true,fillFrom:("fillFrom" in a)?a.fillFrom:Number.NEGATIVE_INFINITY,lineColor:("lineColor" in a)?((a.lineColor=="string")?new Timeplot.Color(a.lineColor):a.lineColor):new Timeplot.Color("#606060"),lineWidth:("lineWidth" in a)?a.lineWidth:1,dotRadius:("dotRadius" in a)?a.dotRadius:2,dotColor:("dotColor" in a)?a.dotColor:null,eventLineWidth:("eventLineWidth" in a)?a.eventLineWidth:1,showValues:("showValues" in a)?a.showValues:false,roundValues:("roundValues" in a)?a.roundValues:true,valuesOpacity:("valuesOpacity" in a)?a.valuesOpacity:75,bubbleWidth:("bubbleWidth" in a)?a.bubbleWidth:300,bubbleHeight:("bubbleHeight" in a)?a.bubbleHeight:200}};Timeplot._Impl=function(a,b){this._id="t"+Math.round(Math.random()*1000000);this._containerDiv=a;this._plotInfos=b;this._painters={background:[],foreground:[]};this._painter=null;this._active=false;this._upright=false;this._initialize()};Timeplot._Impl.prototype={dispose:function(){for(var a=0;a<this._plots.length;a++){this._plots[a].dispose()}this._plots=null;this._plotsInfos=null;this._containerDiv.innerHTML=""},getElement:function(){return this._containerDiv},getDocument:function(){return this._containerDiv.ownerDocument},add:function(a){this._containerDiv.appendChild(a)},remove:function(a){this._containerDiv.removeChild(a)},addPainter:function(d,a){var b=this._painters[d];if(b){for(var c=0;c<b.length;c++){if(b[c].context._id==a.context._id){return}}b.push(a)}},removePainter:function(d,a){var b=this._painters[d];if(b){for(var c=0;c<b.length;c++){if(b[c].context._id==a.context._id){b.splice(c,1);break}}}},getWidth:function(){return this._containerDiv.clientWidth},getHeight:function(){return this._containerDiv.clientHeight},getCanvas:function(){return this._canvas},loadText:function(a,c,f,g,d){if(this._active){var b=this;var e=function(i,k,j){alert("Failed to load data xml from "+a+"\n"+i);b.hideLoadingMessage()};var h=function(j){try{f.loadText(j.responseText,c,a,g,d)}catch(i){SimileAjax.Debug.exception(i)}finally{b.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,e,h)},0)}},loadXML:function(e,c){if(this._active){var a=this;var b=function(f,h,g){alert("Failed to load data xml from "+e+"\n"+f);a.hideLoadingMessage()};var d=function(f){try{var g=f.responseXML;if(!g.documentElement&&f.responseStream){g.load(f.responseStream)}c.loadXML(g,e)}finally{a.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(e,b,d)},0)}},putText:function(b,d,a,e){var c=this.putDiv(b,"timeplot-div "+a,e);c.innerHTML=d;return c},putDiv:function(b,f,e){var d=this._id+"-"+b;var c=document.getElementById(d);if(!c){var a=this._containerDiv.firstChild;c=document.createElement("div");c.setAttribute("id",d);a.appendChild(c)}c.setAttribute("class","timeplot-div "+f);c.setAttribute("className","timeplot-div "+f);this.placeDiv(c,e);return c},placeDiv:function(b,a){if(a){for(style in a){if(style=="left"){a[style]+=this._paddingX;a[style]+="px"}else{if(style=="right"){a[style]+=this._paddingX;a[style]+="px"}else{if(style=="top"){a[style]+=this._paddingY;a[style]+="px"}else{if(style=="bottom"){a[style]+=this._paddingY;a[style]+="px"}else{if(style=="width"){if(a[style]<0){a[style]=0}a[style]+="px"}else{if(style=="height"){if(a[style]<0){a[style]=0}a[style]+="px"}}}}}}b.style[style]=a[style]}}},locate:function(a){return{x:a.offsetLeft-this._paddingX,y:a.offsetTop-this._paddingY}},update:function(){if(this._active){for(var d=0;d<this._plots.length;d++){var c=this._plots[d];var b=c.getDataSource();if(b){var a=b.getRange();if(a){c._valueGeometry.setRange(a);c._timeGeometry.setRange(a)}}c.hideValues()}this.paint()}},repaint:function(){if(this._active){this._prepareCanvas();for(var a=0;a<this._plots.length;a++){var b=this._plots[a];if(b._timeGeometry){b._timeGeometry.reset()}if(b._valueGeometry){b._valueGeometry.reset()}}this.paint()}},paint:function(){if(this._active&&this._painter==null){var a=this;this._painter=window.setTimeout(function(){a._clearCanvas();var b=function(g,h){try{if(h.setTimeplot){h.setTimeplot(a)}g.apply(h,[])}catch(f){SimileAjax.Debug.exception(f)}};var d=a._painters.background;for(var e=0;e<d.length;e++){b(d[e].action,d[e].context)}var c=a._painters.foreground;for(var e=0;e<c.length;e++){b(c[e].action,c[e].context)}a._painter=null},20)}},_clearCanvas:function(){var b=this.getCanvas();var a=b.getContext("2d");a.clearRect(0,0,b.width,b.height)},_clearLabels:function(){var a=this._containerDiv.firstChild;if(a){this._containerDiv.removeChild(a)}a=document.createElement("div");this._containerDiv.appendChild(a)},_prepareCanvas:function(){var b=this.getCanvas();var c=SimileAjax.jQuery(this._containerDiv);this._paddingX=(parseInt(c.css("paddingLeft"))+parseInt(c.css("paddingRight")))/2;this._paddingY=(parseInt(c.css("paddingTop"))+parseInt(c.css("paddingBottom")))/2;b.width=this.getWidth()-(this._paddingX*2);b.height=this.getHeight()-(this._paddingY*2);var a=b.getContext("2d");this._setUpright(a,b);a.globalCompositeOperation="source-over"},_setUpright:function(a,b){if(!SimileAjax.Platform.browser.isIE){this._upright=false}if(!this._upright){this._upright=true;a.translate(0,b.height);a.scale(1,-1)}},_isBrowserSupported:function(b){var a=SimileAjax.Platform.browser;if((b.getContext&&window.getComputedStyle)||(a.isIE&&a.majorVersion>=6)){return true}else{return false}},_initialize:function(){SimileAjax.WindowManager.initialize();var h=this._containerDiv;var f=h.ownerDocument;h.className="timeplot-container "+h.className;while(h.firstChild){h.removeChild(h.firstChild)}var c=f.createElement("canvas");if(this._isBrowserSupported(c)){this._clearLabels();this._canvas=c;c.className="timeplot-canvas";h.appendChild(c);if(!c.getContext&&G_vmlCanvasManager){c=G_vmlCanvasManager.initElement(this._canvas);this._canvas=c}this._prepareCanvas();var b=SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/copyright.png");b.className="timeplot-copyright";b.title="Timeplot (c) SIMILE - http://simile.mit.edu/timeplot/";SimileAjax.DOM.registerEvent(b,"click",function(){window.location="http://simile.mit.edu/timeplot/"});h.appendChild(b);var j=this;var g={onAddMany:function(){j.update()},onClear:function(){j.update()}};this._plots=[];if(this._plotInfos){for(var a=0;a<this._plotInfos.length;a++){var i=new Timeplot.Plot(this,this._plotInfos[a]);var d=i.getDataSource();if(d){d.addListener(g)}this.addPainter("background",{context:i.getTimeGeometry(),action:i.getTimeGeometry().paint});this.addPainter("background",{context:i.getValueGeometry(),action:i.getValueGeometry().paint});this.addPainter("foreground",{context:i,action:i.paint});this._plots.push(i);i.initialize()}}var e=SimileAjax.Graphics.createMessageBubble(f);e.containerDiv.className="timeplot-message-container";h.appendChild(e.containerDiv);e.contentDiv.className="timeplot-message";e.contentDiv.innerHTML="<img src='"+Timeplot.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){e.containerDiv.style.display="block"};this.hideLoadingMessage=function(){e.containerDiv.style.display="none"};this._active=true}else{this._message=SimileAjax.Graphics.createMessageBubble(f);this._message.containerDiv.className="timeplot-message-container";this._message.containerDiv.style.top="15%";this._message.containerDiv.style.left="20%";this._message.containerDiv.style.right="20%";this._message.containerDiv.style.minWidth="20em";this._message.contentDiv.className="timeplot-message";this._message.contentDiv.innerHTML="We're terribly sorry, but your browser is not currently supported by <a href='http://simile.mit.edu/timeplot/'>Timeplot</a>.<br><br> We are working on supporting it in the near future but, for now, see the <a href='http://simile.mit.edu/wiki/Timeplot_Limitations'>list of currently supported browsers</a>.";this._message.containerDiv.style.display="block";h.appendChild(this._message.containerDiv)}}};Timeplot.Plot=function(a,b){this._timeplot=a;this._canvas=a.getCanvas();this._plotInfo=b;this._id=b.id;this._timeGeometry=b.timeGeometry;this._valueGeometry=b.valueGeometry;this._theme=new Timeline.getDefaultTheme();this._dataSource=b.dataSource;this._eventSource=b.eventSource;this._bubble=null};Timeplot.Plot.prototype={initialize:function(){if(this._dataSource&&this._dataSource.getValue){this._timeFlag=this._timeplot.putDiv("timeflag","timeplot-timeflag");this._valueFlag=this._timeplot.putDiv(this._id+"valueflag","timeplot-valueflag");this._valueFlagLineLeft=this._timeplot.putDiv(this._id+"valueflagLineLeft","timeplot-valueflag-line");this._valueFlagLineRight=this._timeplot.putDiv(this._id+"valueflagLineRight","timeplot-valueflag-line");if(!this._valueFlagLineLeft.firstChild){this._valueFlagLineLeft.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_left.png"));this._valueFlagLineRight.appendChild(SimileAjax.Graphics.createTranslucentImage(Timeplot.urlPrefix+"images/line_right.png"))}this._valueFlagPole=this._timeplot.putDiv(this._id+"valuepole","timeplot-valueflag-pole");var e=this._plotInfo.valuesOpacity;SimileAjax.Graphics.setOpacity(this._timeFlag,e);SimileAjax.Graphics.setOpacity(this._valueFlag,e);SimileAjax.Graphics.setOpacity(this._valueFlagLineLeft,e);SimileAjax.Graphics.setOpacity(this._valueFlagLineRight,e);SimileAjax.Graphics.setOpacity(this._valueFlagPole,e);var c=this;var b=function(i,j,h){if(c._plotInfo.showValues){c._valueFlag.style.display="block";a(i,j,h)}};var g=24*60*60*1000;var d=30*g;var a=function(u,i,p){if(typeof SimileAjax!="undefined"&&c._plotInfo.showValues){var n=c._canvas;var k=Math.round(SimileAjax.DOM.getEventRelativeCoordinates(i,c._canvas).x);if(k>n.width){k=n.width}if(isNaN(k)||k<0){k=0}var h=c._timeGeometry.fromScreen(k);if(h==0){c._valueFlag.style.display="none";return}var j=c._dataSource.getValue(h);if(c._plotInfo.roundValues){j=Math.round(j)}c._valueFlag.innerHTML=new String(j);var o=new Date(h);var v=c._timeGeometry.getPeriod();if(v<g){c._timeFlag.innerHTML=o.toLocaleTimeString()}else{if(v>d){c._timeFlag.innerHTML=o.toLocaleDateString()}else{c._timeFlag.innerHTML=o.toLocaleString()}}var q=c._timeFlag.clientWidth;var w=c._timeFlag.clientHeight;var t=Math.round(q/2);var l=c._valueFlag.clientWidth;var r=c._valueFlag.clientHeight;var m=c._valueGeometry.toScreen(j);if(k+t>n.width){var s=n.width-t}else{if(k-t<0){var s=t}else{var s=k}}if(c._timeGeometry._timeValuePosition=="top"){c._timeplot.placeDiv(c._valueFlagPole,{left:k,top:w-5,height:n.height-m-w+6,display:"block"});c._timeplot.placeDiv(c._timeFlag,{left:s-t,top:-6,display:"block"})}else{c._timeplot.placeDiv(c._valueFlagPole,{left:k,bottom:w-5,height:m-w+6,display:"block"});c._timeplot.placeDiv(c._timeFlag,{left:s-t,bottom:-6,display:"block"})}if(k+l+14>n.width&&m+r+4>n.height){c._valueFlagLineLeft.style.display="none";c._timeplot.placeDiv(c._valueFlagLineRight,{left:k-14,bottom:m-14,display:"block"});c._timeplot.placeDiv(c._valueFlag,{left:k-l-13,bottom:m-r-13,display:"block"})}else{if(k+l+14>n.width&&m+r+4<n.height){c._valueFlagLineRight.style.display="none";c._timeplot.placeDiv(c._valueFlagLineLeft,{left:k-14,bottom:m,display:"block"});c._timeplot.placeDiv(c._valueFlag,{left:k-l-13,bottom:m+13,display:"block"})}else{if(k+l+14<n.width&&m+r+4>n.height){c._valueFlagLineRight.style.display="none";c._timeplot.placeDiv(c._valueFlagLineLeft,{left:k,bottom:m-13,display:"block"});c._timeplot.placeDiv(c._valueFlag,{left:k+13,bottom:m-13,display:"block"})}else{c._valueFlagLineLeft.style.display="none";c._timeplot.placeDiv(c._valueFlagLineRight,{left:k,bottom:m,display:"block"});c._timeplot.placeDiv(c._valueFlag,{left:k+13,bottom:m+13,display:"block"})}}}}};var f=this._timeplot.getElement();SimileAjax.DOM.registerEvent(f,"mouseover",b);SimileAjax.DOM.registerEvent(f,"mousemove",a)}},dispose:function(){if(this._dataSource){this._dataSource.removeListener(this._paintingListener);this._paintingListener=null;this._dataSource.dispose();this._dataSource=null}},hideValues:function(){if(this._valueFlag){this._valueFlag.style.display="none"}if(this._timeFlag){this._timeFlag.style.display="none"}if(this._valueFlagLineLeft){this._valueFlagLineLeft.style.display="none"}if(this._valueFlagLineRight){this._valueFlagLineRight.style.display="none"}if(this._valueFlagPole){this._valueFlagPole.style.display="none"}},getDataSource:function(){return(this._dataSource)?this._dataSource:this._eventSource},getTimeGeometry:function(){return this._timeGeometry},getValueGeometry:function(){return this._valueGeometry},paint:function(){var g=this._canvas.getContext("2d");g.lineWidth=this._plotInfo.lineWidth;g.lineJoin="miter";if(this._dataSource){if(this._plotInfo.fillColor){if(this._plotInfo.fillGradient){var s=g.createLinearGradient(0,this._canvas.height,0,0);s.addColorStop(0,this._plotInfo.fillColor.toString());s.addColorStop(0.5,this._plotInfo.fillColor.toString());s.addColorStop(1,"rgba(255,255,255,0)");g.fillStyle=s}else{g.fillStyle=this._plotInfo.fillColor.toString()}g.beginPath();g.moveTo(0,0);this._plot(function(u,t){g.lineTo(u,t)});if(this._plotInfo.fillFrom==Number.NEGATIVE_INFINITY){g.lineTo(this._canvas.width,0)}else{if(this._plotInfo.fillFrom==Number.POSITIVE_INFINITY){g.lineTo(this._canvas.width,this._canvas.height);g.lineTo(0,this._canvas.height)}else{g.lineTo(this._canvas.width,this._valueGeometry.toScreen(this._plotInfo.fillFrom));g.lineTo(0,this._valueGeometry.toScreen(this._plotInfo.fillFrom))}}g.fill()}if(this._plotInfo.lineColor){g.strokeStyle=this._plotInfo.lineColor.toString();g.beginPath();var n=true;this._plot(function(u,t){if(n){n=false;g.moveTo(u,t)}g.lineTo(u,t)});g.stroke()}if(this._plotInfo.dotColor){g.fillStyle=this._plotInfo.dotColor.toString();var i=this._plotInfo.dotRadius;this._plot(function(u,t){g.beginPath();g.arc(u,t,i,0,2*Math.PI,true);g.fill()})}}if(this._eventSource){var s=g.createLinearGradient(0,0,0,this._canvas.height);s.addColorStop(1,"rgba(255,255,255,0)");g.strokeStyle=s;g.fillStyle=s;g.lineWidth=this._plotInfo.eventLineWidth;g.lineJoin="miter";var c=this._eventSource.getAllEventIterator();while(c.hasNext()){var d=c.next();var f=d.getColor();f=(f)?new Timeplot.Color(f):this._plotInfo.lineColor;var r=d.getStart().getTime();var b=d.getEnd().getTime();if(r==b){var a=f.toString();s.addColorStop(0,a);var o=this._timeGeometry.toScreen(r);o=Math.floor(o)+0.5;var q=o;g.beginPath();g.moveTo(o,0);g.lineTo(o,this._canvas.height);g.stroke();var m=o-4;var k=7}else{var a=f.toString(0.5);s.addColorStop(0,a);var o=this._timeGeometry.toScreen(r);o=Math.floor(o)+0.5;var q=this._timeGeometry.toScreen(b);q=Math.floor(q)+0.5;g.fillRect(o,0,q-o,this._canvas.height);var m=o;var k=q-o-1}var j=this._timeplot.putDiv(d.getID(),"timeplot-event-box",{left:Math.round(m),width:Math.round(k),top:0,height:this._canvas.height-1});var e=this;var l=function(t){return function(u,w,x){var y=e._timeplot.getDocument();e._closeBubble();var z=SimileAjax.DOM.getEventPageCoordinates(w);var v=SimileAjax.DOM.getPageCoordinates(u);e._bubble=SimileAjax.Graphics.createBubbleForPoint(z.x,v.top+e._canvas.height,e._plotInfo.bubbleWidth,e._plotInfo.bubbleHeight,"bottom");t.fillInfoBubble(e._bubble.content,e._theme,e._timeGeometry.getLabeler())}};var p=function(u,v,t){u.oldClass=u.className;u.className=u.className+" timeplot-event-box-highlight"};var h=function(u,v,t){u.className=u.oldClass;u.oldClass=null};if(!j.instrumented){SimileAjax.DOM.registerEvent(j,"click",l(d));SimileAjax.DOM.registerEvent(j,"mouseover",p);SimileAjax.DOM.registerEvent(j,"mouseout",h);j.instrumented=true}}}},_plot:function(d){var e=this._dataSource.getData();if(e){var c=e.times;var h=e.values;var g=c.length;for(var f=0;f<g;f++){var a=this._timeGeometry.toScreen(c[f]);var b=this._valueGeometry.toScreen(h[f]);d(a,b)}}},_closeBubble:function(){if(this._bubble!=null){this._bubble.close();this._bubble=null}}};Timeplot.DefaultEventSource=function(a){Timeline.DefaultEventSource.apply(this,arguments)};Object.extend(Timeplot.DefaultEventSource.prototype,Timeline.DefaultEventSource.prototype);Timeplot.DefaultEventSource.prototype.loadText=function(f,j,d,b,h){if(f==null){return}this._events.maxValues=new Array();var c=this._getBaseURL(d);if(!h){h="iso8601"}var k=this._events.getUnit().getParser(h);var l=this._parseText(f,j);var i=false;if(b){l=b(l)}if(l){for(var m=0;m<l.length;m++){var e=l[m];if(e.length>1){var n=SimileAjax.jQuery.trim(e[0]);var a=k(n);if(a){var g=new Timeplot.DefaultEventSource.NumericEvent(a,e.slice(1));this._events.add(g);i=true}}}}if(i){this._fire("onAddMany",[])}};Timeplot.DefaultEventSource.prototype._parseText=function(g,b){g=g.replace(/\r\n?/g,"\n");var i=0;var j=g.length;var f=[];while(i<j){var e=[];if(g.charAt(i)!="#"){while(i<j){if(g.charAt(i)=='"'){var d=g.indexOf('"',i+1);while(d<j&&d>-1){if(g.charAt(d+1)!='"'){break}d=g.indexOf('"',d+2)}if(d<0){}else{if(g.charAt(d+1)==b){var c=g.substr(i+1,d-i-1);c=c.replace(/""/g,'"');e[e.length]=c;i=d+2;continue}else{if(g.charAt(d+1)=="\n"||j==d+1){var c=g.substr(i+1,d-i-1);c=c.replace(/""/g,'"');e[e.length]=c;i=d+2;break}else{}}}}var h=g.indexOf(b,i);var a=g.indexOf("\n",i);if(a<0){a=j}if(h>-1&&h<a){e[e.length]=g.substr(i,h-i);i=h+1}else{e[e.length]=g.substr(i,a-i);i=a+1;break}}}else{var a=g.indexOf("\n",i);i=(a>-1)?a+1:cur}if(e.length>0){f[f.length]=e}}if(f.length<0){return}return f};Timeplot.DefaultEventSource.prototype.getRange=function(){var a=this.getEarliestDate();var b=this.getLatestDate();return{earliestDate:(a)?a:null,latestDate:(b)?b:null,min:0,max:0}};Timeplot.DefaultEventSource.NumericEvent=function(b,a){this._id="e"+Math.round(Math.random()*1000000);this._time=b;this._values=a};Timeplot.DefaultEventSource.NumericEvent.prototype={getID:function(){return this._id},getTime:function(){return this._time},getValues:function(){return this._values},getStart:function(){return this._time},getEnd:function(){return this._time}};Timeplot.DataSource=function(b){this._eventSource=b;var a=this;this._processingListener={onAddMany:function(){a._process()},onClear:function(){a._clear()}};this.addListener(this._processingListener);this._listeners=[];this._data=null;this._range=null};Timeplot.DataSource.prototype={_clear:function(){this._data=null;this._range=null},_process:function(){this._data={times:new Array(),values:new Array()};this._range={earliestDate:null,latestDate:null,min:0,max:0}},getRange:function(){return this._range},getData:function(){return this._data},getValue:function(b){if(this._data){for(var c=0;c<this._data.times.length;c++){var a=this._data.times[c];if(a>=b){return this._data.values[c]}}}return 0},addListener:function(a){this._eventSource.addListener(a)},removeListener:function(a){this._eventSource.removeListener(a)},replaceListener:function(a,b){this.removeListener(a);this.addListener(b)}};Timeplot.ColumnSource=function(b,a){Timeplot.DataSource.apply(this,arguments);this._column=a-1};Object.extend(Timeplot.ColumnSource.prototype,Timeplot.DataSource.prototype);Timeplot.ColumnSource.prototype.dispose=function(){this.removeListener(this._processingListener);this._clear()};Timeplot.ColumnSource.prototype._process=function(){var h=this._eventSource.getCount();var d=new Array(h);var e=new Array(h);var a=Number.MAX_VALUE;var g=Number.MIN_VALUE;var j=0;var i=this._eventSource.getAllEventIterator();while(i.hasNext()){var c=i.next();var b=c.getTime();d[j]=b;var f=this._getValue(c);if(!isNaN(f)){if(f<a){a=f}if(f>g){g=f}e[j]=f}j++}this._data={times:d,values:e};if(g==Number.MIN_VALUE){g=1}this._range={earliestDate:this._eventSource.getEarliestDate(),latestDate:this._eventSource.getLatestDate(),min:a,max:g}};Timeplot.ColumnSource.prototype._getValue=function(a){return parseFloat(a.getValues()[this._column])};Timeplot.ColumnDiffSource=function(b,c,a){Timeplot.ColumnSource.apply(this,arguments);this._column2=a-1};Object.extend(Timeplot.ColumnDiffSource.prototype,Timeplot.ColumnSource.prototype);Timeplot.ColumnDiffSource.prototype._getValue=function(b){var c=parseFloat(b.getValues()[this._column]);var a=parseFloat(b.getValues()[this._column2]);return c-a};Timeplot.DefaultValueGeometry=function(a){if(!a){a={}}this._id=("id" in a)?a.id:"g"+Math.round(Math.random()*1000000);this._axisColor=("axisColor" in a)?((typeof a.axisColor=="string")?new Timeplot.Color(a.axisColor):a.axisColor):new Timeplot.Color("#606060"),this._gridColor=("gridColor" in a)?((typeof a.gridColor=="string")?new Timeplot.Color(a.gridColor):a.gridColor):null,this._gridLineWidth=("gridLineWidth" in a)?a.gridLineWidth:0.5;this._axisLabelsPlacement=("axisLabelsPlacement" in a)?a.axisLabelsPlacement:"right";this._gridSpacing=("gridSpacing" in a)?a.gridStep:50;this._gridType=("gridType" in a)?a.gridType:"short";this._gridShortSize=("gridShortSize" in a)?a.gridShortSize:10;this._minValue=("min" in a)?a.min:null;this._maxValue=("max" in a)?a.max:null;this._linMap={direct:function(b){return b},inverse:function(b){return b}};this._map=this._linMap;this._labels=[];this._grid=[]};Timeplot.DefaultValueGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if((this._minValue==null)||((this._minValue!=null)&&(a.min<this._minValue))){this._minValue=a.min}if((this._maxValue==null)||((this._maxValue!=null)&&(a.max*1.05>this._maxValue))){this._maxValue=a.max*1.05}this._updateMappedValues();if(!(this._minValue==0&&this._maxValue==0)){this._grid=this._calculateGrid()}},reset:function(){this._clearLabels();this._updateMappedValues();this._grid=this._calculateGrid()},toScreen:function(b){if(this._canvas&&this._maxValue){var a=b-this._minValue;return this._canvas.height*(this._map.direct(a))/this._mappedRange}else{return -50}},fromScreen:function(a){if(this._canvas){return this._map.inverse(this._mappedRange*a/this._canvas.height)+this._minValue}else{return 0}},paint:function(){if(this._timeplot){var g=this._canvas.getContext("2d");g.lineJoin="miter";if(this._gridColor){var d=g.createLinearGradient(0,0,0,this._canvas.height);d.addColorStop(0,this._gridColor.toHexString());d.addColorStop(0.3,this._gridColor.toHexString());d.addColorStop(1,"rgba(255,255,255,0.5)");g.lineWidth=this._gridLineWidth;g.strokeStyle=d;for(var e=0;e<this._grid.length;e++){var f=this._grid[e];var b=Math.floor(f.y)+0.5;if(typeof f.label!="undefined"){if(this._axisLabelsPlacement=="left"){var c=this._timeplot.putText(this._id+"-"+e,f.label,"timeplot-grid-label",{left:4,bottom:b+2,color:this._gridColor.toHexString(),visibility:"hidden"})}else{if(this._axisLabelsPlacement=="right"){var c=this._timeplot.putText(this._id+"-"+e,f.label,"timeplot-grid-label",{right:4,bottom:b+2,color:this._gridColor.toHexString(),visibility:"hidden"})}}if(b+c.clientHeight<this._canvas.height+10){c.style.visibility="visible"}}g.beginPath();if(this._gridType=="long"||f.label==0){g.moveTo(0,b);g.lineTo(this._canvas.width,b)}else{if(this._gridType=="short"){if(this._axisLabelsPlacement=="left"){g.moveTo(0,b);g.lineTo(this._gridShortSize,b)}else{if(this._axisLabelsPlacement=="right"){g.moveTo(this._canvas.width,b);g.lineTo(this._canvas.width-this._gridShortSize,b)}}}}g.stroke()}}var a=g.createLinearGradient(0,0,0,this._canvas.height);a.addColorStop(0,this._axisColor.toString());a.addColorStop(0.5,this._axisColor.toString());a.addColorStop(1,"rgba(255,255,255,0.5)");g.lineWidth=1;g.strokeStyle=a;g.beginPath();g.moveTo(0,this._canvas.height);g.lineTo(0,0);g.stroke();g.beginPath();g.moveTo(this._canvas.width,0);g.lineTo(this._canvas.width,this._canvas.height);g.stroke()}},_clearLabels:function(){for(var c=0;c<this._labels.length;c++){var a=this._labels[c];var b=a.parentNode;if(b){b.removeChild(a)}}},_calculateGrid:function(){var f=[];if(!this._canvas||this._valueRange==0){return f}var e=0;if(this._valueRange>1){while(Math.pow(10,e)<this._valueRange){e++}e--}else{while(Math.pow(10,e)>this._valueRange){e--}}var d=Math.pow(10,e);var c=d;while(true){var a=this.toScreen(this._minValue+c);while(a<this._gridSpacing){c+=d;a=this.toScreen(this._minValue+c)}if(a>2*this._gridSpacing){d/=10;c=d}else{break}}var g=0;var b=this.toScreen(g);if(this._minValue>=0){while(b<this._canvas.height){if(b>0){f.push({y:b,label:g})}g+=c;b=this.toScreen(g)}}else{if(this._maxValue<=0){while(b>0){if(b<this._canvas.height){f.push({y:b,label:g})}g-=c;b=this.toScreen(g)}}else{while(b<this._canvas.height){if(b>0){f.push({y:b,label:g})}g+=c;b=this.toScreen(g)}g=-c;b=this.toScreen(g);while(b>0){if(b<this._canvas.height){f.push({y:b,label:g})}g-=c;b=this.toScreen(g)}}}return f},_updateMappedValues:function(){this._valueRange=Math.abs(this._maxValue-this._minValue);this._mappedRange=this._map.direct(this._valueRange)}};Timeplot.LogarithmicValueGeometry=function(a){Timeplot.DefaultValueGeometry.apply(this,arguments);this._logMap={direct:function(b){return Math.log(b+1)/Math.log(10)},inverse:function(b){return Math.exp(Math.log(10)*b)-1}};this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid};Timeplot.LogarithmicValueGeometry.prototype._linearCalculateGrid=Timeplot.DefaultValueGeometry.prototype._calculateGrid;Object.extend(Timeplot.LogarithmicValueGeometry.prototype,Timeplot.DefaultValueGeometry.prototype);Timeplot.LogarithmicValueGeometry.prototype._logarithmicCalculateGrid=function(){var c=[];if(!this._canvas||this._valueRange==0){return c}var a=1;var b=this.toScreen(a);while(b<this._canvas.height||isNaN(b)){if(b>0){c.push({y:b,label:a})}a*=10;b=this.toScreen(a)}return c};Timeplot.LogarithmicValueGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this._calculateGrid=this._linearCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.actLogarithmic=function(){this._mode="log";this._map=this._logMap;this._calculateGrid=this._logarithmicCalculateGrid;this.reset()};Timeplot.LogarithmicValueGeometry.prototype.toggle=function(){if(this._mode=="log"){this.actLinear()}else{this.actLogarithmic()}};Timeplot.DefaultTimeGeometry=function(b){if(!b){b={}}this._id=("id" in b)?b.id:"g"+Math.round(Math.random()*1000000);this._locale=("locale" in b)?b.locale:"en";this._timeZone=("timeZone" in b)?b.timeZone:SimileAjax.DateTime.getTimezone();this._labeller=("labeller" in b)?b.labeller:null;this._axisColor=("axisColor" in b)?((b.axisColor=="string")?new Timeplot.Color(b.axisColor):b.axisColor):new Timeplot.Color("#606060"),this._gridColor=("gridColor" in b)?((b.gridColor=="string")?new Timeplot.Color(b.gridColor):b.gridColor):null,this._gridLineWidth=("gridLineWidth" in b)?b.gridLineWidth:0.5;this._axisLabelsPlacement=("axisLabelsPlacement" in b)?b.axisLabelsPlacement:"bottom";this._gridStep=("gridStep" in b)?b.gridStep:100;this._gridStepRange=("gridStepRange" in b)?b.gridStepRange:20;this._min=("min" in b)?b.min:null;this._max=("max" in b)?b.max:null;this._timeValuePosition=("timeValuePosition" in b)?b.timeValuePosition:"bottom";this._unit=("unit" in b)?b.unit:Timeline.NativeDateUnit;this._linMap={direct:function(c){return c},inverse:function(c){return c}};this._map=this._linMap;this._labeler=this._unit.createLabeller(this._locale,this._timeZone);var a=this._unit.getParser("iso8601");if(this._min&&!this._min.getTime){this._min=a(this._min)}if(this._max&&!this._max.getTime){this._max=a(this._max)}this._grid=[]};Timeplot.DefaultTimeGeometry.prototype={setTimeplot:function(a){this._timeplot=a;this._canvas=a.getCanvas();this.reset()},setRange:function(a){if(this._min){this._earliestDate=this._min}else{if(a.earliestDate&&((this._earliestDate==null)||((this._earliestDate!=null)&&(a.earliestDate.getTime()<this._earliestDate.getTime())))){this._earliestDate=a.earliestDate}}if(this._max){this._latestDate=this._max}else{if(a.latestDate&&((this._latestDate==null)||((this._latestDate!=null)&&(a.latestDate.getTime()>this._latestDate.getTime())))){this._latestDate=a.latestDate}}if(!this._earliestDate&&!this._latestDate){this._grid=[]}else{this.reset()}},reset:function(){this._updateMappedValues();if(this._canvas){this._grid=this._calculateGrid()}},toScreen:function(b){if(this._canvas&&this._latestDate){var a=b-this._earliestDate.getTime();return this._canvas.width*this._map.direct(a)/this._mappedPeriod}else{return -50}},fromScreen:function(a){if(this._canvas){return this._map.inverse(this._mappedPeriod*a/this._canvas.width)+this._earliestDate.getTime()}else{return 0}},getPeriod:function(){return this._period},getLabeler:function(){return this._labeler},getUnit:function(){return this._unit},paint:function(){if(this._canvas){var d=this._unit;var g=this._canvas.getContext("2d");var c=g.createLinearGradient(0,0,0,this._canvas.height);g.strokeStyle=c;g.lineWidth=this._gridLineWidth;g.lineJoin="miter";if(this._gridColor){c.addColorStop(0,this._gridColor.toString());c.addColorStop(1,"rgba(255,255,255,0.9)");for(var e=0;e<this._grid.length;e++){var f=this._grid[e];var a=Math.floor(f.x)+0.5;if(this._axisLabelsPlacement=="top"){var b=this._timeplot.putText(this._id+"-"+e,f.label,"timeplot-grid-label",{left:a+4,top:2,visibility:"hidden"})}else{if(this._axisLabelsPlacement=="bottom"){var b=this._timeplot.putText(this._id+"-"+e,f.label,"timeplot-grid-label",{left:a+4,bottom:2,visibility:"hidden"})}}if(a+b.clientWidth<this._canvas.width+10){b.style.visibility="visible"}g.beginPath();g.moveTo(a,0);g.lineTo(a,this._canvas.height);g.stroke()}}c.addColorStop(0,this._axisColor.toString());c.addColorStop(1,"rgba(255,255,255,0.5)");g.lineWidth=1;c.addColorStop(0,this._axisColor.toString());g.beginPath();g.moveTo(0,0);g.lineTo(this._canvas.width,0);g.stroke()}},_calculateGrid:function(){var d=[];var a=SimileAjax.DateTime;var f=this._unit;var c=this._period;if(c==0){return d}if(c>a.gregorianUnitLengths[a.MILLENNIUM]){g=a.MILLENNIUM}else{for(var g=a.MILLENNIUM;g>0;g--){if(a.gregorianUnitLengths[g-1]<=c&&c<a.gregorianUnitLengths[g]){g--;break}}}var e=f.cloneValue(this._earliestDate);do{a.roundDownToInterval(e,g,this._timeZone,1,0);var h=this.toScreen(f.toNumber(e));switch(g){case a.SECOND:var i=e.toLocaleTimeString();break;case a.MINUTE:var b=e.getMinutes();var i=e.getHours()+":"+((b<10)?"0":"")+b;break;case a.HOUR:var i=e.getHours()+":00";break;case a.DAY:case a.WEEK:case a.MONTH:var i=e.toLocaleDateString();break;case a.YEAR:case a.DECADE:case a.CENTURY:case a.MILLENNIUM:var i=e.getUTCFullYear();break}if(h>0){d.push({x:h,label:i})}a.incrementByInterval(e,g,this._timeZone)}while(e.getTime()<this._latestDate.getTime());return d},_updateMappedValues:function(){if(this._latestDate&&this._earliestDate){this._period=this._latestDate.getTime()-this._earliestDate.getTime();this._mappedPeriod=this._map.direct(this._period)}else{this._period=0;this._mappedPeriod=0}}};Timeplot.MagnifyingTimeGeometry=function(b){Timeplot.DefaultTimeGeometry.apply(this,arguments);var a=this;this._MagnifyingMap={direct:function(c){if(c<a._leftTimeMargin){var d=c*a._leftRate}else{if(a._leftTimeMargin<c&&c<a._rightTimeMargin){var d=c*a._expandedRate+a._expandedTimeTranslation}else{var d=c*a._rightRate+a._rightTimeTranslation}}return d},inverse:function(d){if(d<a._leftScreenMargin){var c=d/a._leftRate}else{if(a._leftScreenMargin<d&&d<a._rightScreenMargin){var c=d/a._expandedRate+a._expandedScreenTranslation}else{var c=d/a._rightRate+a._rightScreenTranslation}}return c}};this._mode="lin";this._map=this._linMap};Object.extend(Timeplot.MagnifyingTimeGeometry.prototype,Timeplot.DefaultTimeGeometry.prototype);Timeplot.MagnifyingTimeGeometry.prototype.initialize=function(i){Timeplot.DefaultTimeGeometry.prototype.initialize.apply(this,arguments);if(!this._lens){this._lens=this._timeplot.putDiv("lens","timeplot-lens")}var h=1000*60*60*24*30;var g=this;var c=function(l){var m=l.clientWidth;var k=g._timeplot.locate(l);g.setMagnifyingParams(k.x+m/2,m,h);g.actMagnifying();g._timeplot.paint()};var e=function(k,l,m){g._canvas.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(l,k);g._canvas.pressed=true};var f=function(k,l,m){g._canvas.pressed=false;var n=SimileAjax.DOM.getEventRelativeCoordinates(l,k);if(Timeplot.Math.isClose(n,g._canvas.startCoords,5)){g._lens.style.display="none";g.actLinear();g._timeplot.paint()}else{g._lens.style.cursor="move";c(g._lens)}};var a=function(k,l,m){if(g._canvas.pressed){var n=SimileAjax.DOM.getEventRelativeCoordinates(l,k);if(n.x<0){n.x=0}if(n.x>g._canvas.width){n.x=g._canvas.width}g._timeplot.placeDiv(g._lens,{left:g._canvas.startCoords.x,width:n.x-g._canvas.startCoords.x,bottom:0,height:g._canvas.height,display:"block"})}};var d=function(k,l,m){g._lens.startCoords=SimileAjax.DOM.getEventRelativeCoordinates(l,k);g._lens.pressed=true};var b=function(k,l,m){g._lens.pressed=false};var j=function(p,l,m){if(g._lens.pressed){var o=SimileAjax.DOM.getEventRelativeCoordinates(l,p);var k=g._lens;var n=k.offsetLeft+o.x-k.startCoords.x;if(n<g._timeplot._paddingX){n=g._timeplot._paddingX}if(n+k.clientWidth>g._canvas.width-g._timeplot._paddingX){n=g._canvas.width-k.clientWidth+g._timeplot._paddingX}k.style.left=n;c(k)}};if(!this._canvas.instrumented){SimileAjax.DOM.registerEvent(this._canvas,"mousedown",e);SimileAjax.DOM.registerEvent(this._canvas,"mousemove",a);SimileAjax.DOM.registerEvent(this._canvas,"mouseup",f);SimileAjax.DOM.registerEvent(this._canvas,"mouseup",b);this._canvas.instrumented=true}if(!this._lens.instrumented){SimileAjax.DOM.registerEvent(this._lens,"mousedown",d);SimileAjax.DOM.registerEvent(this._lens,"mousemove",j);SimileAjax.DOM.registerEvent(this._lens,"mouseup",b);SimileAjax.DOM.registerEvent(this._lens,"mouseup",f);this._lens.instrumented=true}};Timeplot.MagnifyingTimeGeometry.prototype.setMagnifyingParams=function(b,e,a){e=e/2;a=a/2;var f=this._canvas.width;var c=this._period;if(b<0){b=0}if(b>f){b=f}if(b-e<0){e=b}if(b+e>f){e=f-b}var d=this.fromScreen(b)-this._earliestDate.getTime();if(d-a<0){a=d}if(d+a>c){a=c-d}this._centerX=b;this._centerTime=d;this._aperture=e;this._aperturePeriod=a;this._leftScreenMargin=this._centerX-this._aperture;this._rightScreenMargin=this._centerX+this._aperture;this._leftTimeMargin=this._centerTime-this._aperturePeriod;this._rightTimeMargin=this._centerTime+this._aperturePeriod;this._leftRate=(b-e)/(d-a);this._expandedRate=e/a;this._rightRate=(f-b-e)/(c-d-a);this._expandedTimeTranslation=this._centerX-this._centerTime*this._expandedRate;this._expandedScreenTranslation=this._centerTime-this._centerX/this._expandedRate;this._rightTimeTranslation=(b+e)-(d+a)*this._rightRate;this._rightScreenTranslation=(d+a)-(b+e)/this._rightRate;this._updateMappedValues()};Timeplot.MagnifyingTimeGeometry.prototype.actLinear=function(){this._mode="lin";this._map=this._linMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.actMagnifying=function(){this._mode="Magnifying";this._map=this._MagnifyingMap;this.reset()};Timeplot.MagnifyingTimeGeometry.prototype.toggle=function(){if(this._mode=="Magnifying"){this.actLinear()}else{this.actMagnifying()}};Timeplot.Color=function(a){this._fromHex(a)};Timeplot.Color.prototype={set:function(b,c,a,d){this.r=b;this.g=c;this.b=a;this.a=(d)?d:1;return this.check()},transparency:function(a){this.a=a;return this.check()},lighten:function(b){var a=new Timeplot.Color();return a.set(this.r+=parseInt(b,10),this.g+=parseInt(b,10),this.b+=parseInt(b,10))},darken:function(b){var a=new Timeplot.Color();return a.set(this.r-=parseInt(b,10),this.g-=parseInt(b,10),this.b-=parseInt(b,10))},check:function(){if(this.r>255){this.r=255}else{if(this.r<0){this.r=0}}if(this.g>255){this.g=255}else{if(this.g<0){this.g=0}}if(this.b>255){this.b=255}else{if(this.b<0){this.b=0}}if(this.a>1){this.a=1}else{if(this.a<0){this.a=0}}return this},toString:function(b){var a=(b)?b:((this.a)?this.a:1);return"rgba("+this.r+","+this.g+","+this.b+","+a+")"},toHexString:function(){return"#"+this._toHex(this.r)+this._toHex(this.g)+this._toHex(this.b)},_fromHex:function(a){if(/^#?([\da-f]{3}|[\da-f]{6})$/i.test(a)){a=a.replace(/^#/,"").replace(/^([\da-f])([\da-f])([\da-f])$/i,"$1$1$2$2$3$3");this.r=parseInt(a.substr(0,2),16);this.g=parseInt(a.substr(2,2),16);this.b=parseInt(a.substr(4,2),16)}else{if(/^rgb *\( *\d{0,3} *, *\d{0,3} *, *\d{0,3} *\)$/i.test(a)){a=a.match(/^rgb *\( *(\d{0,3}) *, *(\d{0,3}) *, *(\d{0,3}) *\)$/i);this.r=parseInt(a[1],10);this.g=parseInt(a[2],10);this.b=parseInt(a[3],10)}}this.a=1;return this.check()},_toHex:function(b){var c="0123456789ABCDEF";if(b<0){return"00"}if(b>255){return"FF"}var d=Math.floor(b/16);var a=b%16;return c.charAt(d)+c.charAt(a)}};Timeplot.Math={range:function(b){var d=b.length;var e=Number.MAX_VALUE;var a=Number.MIN_VALUE;for(var f=0;f<d;f++){var c=b[f];if(c<e){e=c}if(c>a){a=c}}if(a==Number.MIN_VALUE){a=0}return{min:e,max:a}},movingAverage:function(c,g){var e=c.length;var f=new Array(e);for(var b=0;b<e;b++){var d=0;for(var a=b-g;a<b+g;a++){if(a<0){var h=c[0]}else{if(a>=e){var h=f[b-1]}else{var h=c[a]}}d+=h}f[b]=d/(2*g)}return f},integral:function(b){var c=b.length;var d=new Array(c);var e=0;for(var a=0;a<c;a++){e+=b[a];d[a]=e}return d},normalize:function(b){var c=b.length;var d=0;for(var a=0;a<c;a++){d+=b[a]}for(var a=0;a<c;a++){b[a]/=d}return b},convolution:function(j,k){var e=j.length;var f=k.length;var i=new Array(e);for(var b=0;b<e;b++){var d=0;var a=(b+f<e)?b+f:e;for(var c=b;c<a;c++){var g=j[c-f];var h=k[c-b];d+=g*h}i[b]=d}return i},heavyside:function(d){var b=new Array(d);var c=1/d;for(var a=0;a<d;a++){b[a]=c}return b},gaussian:function(size,threshold){with(Math){var radius=size/2;var variance=radius*radius/log(threshold);var g=new Array(size);for(var t=0;t<size;t++){var l=t-radius;g[t]=exp(-variance*l*l)}}return this.normalize(g)},round:function(x,n){with(Math){if(abs(x)>1){var l=floor(log(x)/log(10));var d=round(exp((l-n+1)*log(10)));var y=round(round(x/d)*d);return y}else{log("FIXME(SM): still to implement for 0 < abs(x) < 1");return x}}},tanh:function(a){if(a>5){return 1}else{if(a<5){return -1}else{var b=Math.exp(2*a);return(b-1)/(b+1)}}},isClose:function(c,a,b){return(c&&a&&Math.abs(c.x-a.x)<b&&Math.abs(c.y-a.y)<b)}};Timeplot.Operator={sum:function(a,b){return Timeplot.Math.integral(a.values)},average:function(c,b){var d=("size" in b)?b.size:30;var a=Timeplot.Math.movingAverage(c.values,d);return a}};Timeplot.Processor=function(b,a,c){this._dataSource=b;this._operator=a;this._params=c;this._data={times:new Array(),values:new Array()};this._range={earliestDate:null,latestDate:null,min:0,max:0};var d=this;this._processingListener={onAddMany:function(){d._process()},onClear:function(){d._clear()}};this.addListener(this._processingListener)};Timeplot.Processor.prototype={_clear:function(){this.removeListener(this._processingListener);this._dataSource._clear()},_process:function(){var b=this._dataSource.getData();var a=this._dataSource.getRange();var d=this._operator(b,this._params);var c=Timeplot.Math.range(d);this._data={times:b.times,values:d};this._range={earliestDate:a.earliestDate,latestDate:a.latestDate,min:c.min,max:c.max}},getRange:function(){return this._range},getData:function(){return this._data},getValue:Timeplot.DataSource.prototype.getValue,addListener:function(a){this._dataSource.addListener(a)},removeListener:function(a){this._dataSource.removeListener(a)}};